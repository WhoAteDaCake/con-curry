FROM crystallang/crystal:1.0.0-alpine

RUN apk add --update yaml-dev yaml-static

WORKDIR /worker

ADD ./shard.yml .
ADD ./shard.lock .

RUN mkdir dist && shards install

ADD ./src /worker/src

RUN crystal build ./src/concurry.cr \
  --release \
  --progress \
  --static \
  -o ./dist/concurry-arch